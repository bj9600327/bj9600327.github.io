<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>《构建高可用Linux服务器》读书笔记 | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="如何阅读本书 经验不足的读者：先了解第1章 系统管理员和系统工程师：重点关注第3～6章 网络管理员：先学习第1～3章，然后将重点放在第7章和第8章上 项目实施工程师：顺序阅读全书内容，重心可以放在第4章和第5章上。 开发人员：重点放在第1章和第3章上  ch01 Linux服务器的构建与优化1.1 无人值守安装CentOS跳过 1.2 全面了解Linux服务器客户往往不能提供详细的硬件配置清单 1">
<meta property="og:type" content="article">
<meta property="og:title" content="《构建高可用Linux服务器》读书笔记">
<meta property="og:url" content="http://example.com/2021/08/10/high-availability-linux/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="如何阅读本书 经验不足的读者：先了解第1章 系统管理员和系统工程师：重点关注第3～6章 网络管理员：先学习第1～3章，然后将重点放在第7章和第8章上 项目实施工程师：顺序阅读全书内容，重心可以放在第4章和第5章上。 开发人员：重点放在第1章和第3章上  ch01 Linux服务器的构建与优化1.1 无人值守安装CentOS跳过 1.2 全面了解Linux服务器客户往往不能提供详细的硬件配置清单 1">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-08-10T00:36:43.000Z">
<meta property="article:modified_time" content="2022-05-11T03:19:10.190Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-high-availability-linux" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/08/10/high-availability-linux/" class="article-date">
  <time class="dt-published" datetime="2021-08-10T00:36:43.000Z" itemprop="datePublished">2021-08-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/book-note/">book-note</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      《构建高可用Linux服务器》读书笔记
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="如何阅读本书"><a href="#如何阅读本书" class="headerlink" title="如何阅读本书"></a>如何阅读本书</h1><ol>
<li>经验不足的读者：先了解第1章</li>
<li>系统管理员和系统工程师：重点关注第3～6章</li>
<li>网络管理员：先学习第1～3章，然后将重点放在第7章和第8章上</li>
<li>项目实施工程师：顺序阅读全书内容，重心可以放在第4章和第5章上。</li>
<li>开发人员：重点放在第1章和第3章上</li>
</ol>
<h1 id="ch01-Linux服务器的构建与优化"><a href="#ch01-Linux服务器的构建与优化" class="headerlink" title="ch01 Linux服务器的构建与优化"></a>ch01 Linux服务器的构建与优化</h1><h2 id="1-1-无人值守安装CentOS"><a href="#1-1-无人值守安装CentOS" class="headerlink" title="1.1 无人值守安装CentOS"></a>1.1 无人值守安装CentOS</h2><p>跳过</p>
<h2 id="1-2-全面了解Linux服务器"><a href="#1-2-全面了解Linux服务器" class="headerlink" title="1.2 全面了解Linux服务器"></a>1.2 全面了解Linux服务器</h2><p>客户往往不能提供详细的硬件配置清单</p>
<h3 id="1-2-1-CPU"><a href="#1-2-1-CPU" class="headerlink" title="1.2.1 CPU"></a>1.2.1 CPU</h3><ol>
<li><code>cat /proc/cpuinfo | grep &quot;physical id&quot; | sort | uniq</code>显示物理CPU</li>
<li><code>cat /proc/cpuinfo | grep &quot;cpu cores&quot; | uniq</code>显示每个物理CPU中core的个数（即核数）</li>
<li><code>cat /proc/cpuinfo | grep &quot;processor&quot;</code>显示逻辑CPU</li>
</ol>
<h3 id="1-2-2-内存"><a href="#1-2-2-内存" class="headerlink" title="1.2.2 内存"></a>1.2.2 内存</h3><p><code>free -m</code>如果常常看到swap用了很多，你可能就要考虑增加物理内存了</p>
<h3 id="1-2-3-硬盘"><a href="#1-2-3-硬盘" class="headerlink" title="1.2.3 硬盘"></a>1.2.3 硬盘</h3><ol>
<li><code>fdish -l</code>查看硬盘及分区信息</li>
<li><code>df -h</code>查看文件系统的磁盘空间占用情况</li>
<li><code>iostat -d -x -k 1 10</code>查看硬盘的I/O性能</li>
</ol>
<ul>
<li>如果%util接近100%，则说明产生的I/O请求太多，该磁盘可能存在瓶颈</li>
<li>如果await大于5ms就表示磁盘I/O压力很大，这时可以考虑：<ul>
<li>更换响应速度更快的磁盘</li>
<li>调整内核elevator的算法</li>
<li>优化应用</li>
<li>升级CPU</li>
</ul>
</li>
</ul>
<ol start="4">
<li><code>du -sh 目录名</code>查看某目录的大小。分区空间不足时使用组合拳<ul>
<li><code>du -cks * | sort -rn | head -n 10</code></li>
</ul>
</li>
<li>dd命令可以在复制过程中进行格式转换，例如</li>
</ol>
<ul>
<li><code>dd if=/dev/zero of=/swapfile bs=1024 count=65536</code>制作交换文件</li>
<li><code>dd if=rhe140.img of=/dev/fd0 bs=10k</code>把驱动文件复制到软驱</li>
<li><code>dd if=/dev/cdrom of=/root/cd1.iso</code>制作ISO镜像</li>
</ul>
<h3 id="1-2-4-平均负载"><a href="#1-2-4-平均负载" class="headerlink" title="1.2.4 平均负载"></a>1.2.4 平均负载</h3><ol>
<li>uptime命令查看平均负载</li>
<li>w命令还可以查看当前有哪些用户，他们占用了哪些终端</li>
<li>top命令会动态地显示负载情况</li>
</ol>
<ul>
<li>如果load average的输出值大于逻辑CPU的个数，就要结合vmstat命令来判断系统是否国语繁忙</li>
</ul>
<h3 id="1-2-5-其他参数"><a href="#1-2-5-其他参数" class="headerlink" title="1.2.5 其他参数"></a>1.2.5 其他参数</h3><ol>
<li>vmstat是全面的性能分析工具。</li>
</ol>
<ul>
<li>标准情况下：等待运行的进程数r&lt;5，非中断睡眠状态下的进程数b约为0</li>
<li>如果r经常大于3或4，且id（闲置时间）经常少于50，就要考虑更换服务器或增加CPU数量</li>
<li>user% + sys% 表示CPU的用户模式时间 + 系统模式时间<ul>
<li>和 &lt;70% 表示系统性能较好</li>
<li>和&gt;=85% 表示系统性能比较糟糕</li>
</ul>
</li>
</ul>
<ol start="2">
<li>查看系统内核</li>
</ol>
<ul>
<li>内核版本号<ul>
<li>详细<code>uname -a</code></li>
<li>简化<code>uname -r</code></li>
</ul>
</li>
<li>查看系统是32位还是64位<ul>
<li><code>ls -lF / |grep /$ |egrep &#39;lib64|i386&#39;</code></li>
<li><code>file /sbin/init</code></li>
</ul>
</li>
</ul>
<ol start="3">
<li><code>lsb_release -a</code>查看发行版信息，如果CentOS5.8没有此命令，需要安装<code>yum -y install redhat-lsb</code></li>
<li><code>lsmod</code>查看系统已载入的相关模块</li>
<li><code>lspci</code>查找PCI设置，例如网卡、主板集成设备</li>
</ol>
<ul>
<li><code>miit-tool</code>检测机器网卡是否正常连接</li>
</ul>
<h2 id="1-3-Linux服务器的网络配置"><a href="#1-3-Linux服务器的网络配置" class="headerlink" title="1.3 Linux服务器的网络配置"></a>1.3 Linux服务器的网络配置</h2><h3 id="1-3-1-配置Linux服务器的网络"><a href="#1-3-1-配置Linux服务器的网络" class="headerlink" title="1.3.1 配置Linux服务器的网络"></a>1.3.1 配置Linux服务器的网络</h3><ol>
<li>手动修改配置网卡文件。跳过</li>
<li>修改机器的hostname名：编辑/etc/sysconfig/network文件</li>
<li>修改主机名查询静态表/etc/hosts，每一行由3部分组成，分别是<ul>
<li>网络IP地址</li>
<li>主机名或域名</li>
<li>主机名别名（可选）</li>
</ul>
</li>
<li>配置DNS只需修改/etc/resolv.conf，最多支持3个nameserver</li>
</ol>
<h3 id="1-3-2-查看网络连接"><a href="#1-3-2-查看网络连接" class="headerlink" title="1.3.2 查看网络连接"></a>1.3.2 查看网络连接</h3><ol>
<li><code>ifconfig -a</code>显示所有网络接口配置，<code>ifconfig eth0</code>显示指定接口</li>
<li><code>ping -c 5 www.163.com</code>只发5个包</li>
<li>netstat可显示网络连接、路由表和网络接口的信息</li>
</ol>
<ul>
<li><code>netstat -an | grep -v unix</code>显示所有套接字的状态，打印实际地址</li>
<li><code>netstat -an |awk &#39;/^tcp/ &#123;++S[$NF]&#125;END&#123;for (a in S) print a,S[a]&#125;&#39;</code>这个命令组合用于查看State的汇总信息</li>
<li><code>netstat -rn</code>与<code>route -n</code>都能查看路由表，输出中带有UG的行是默认网关</li>
</ul>
<ol start="4">
<li>nslookup跨平台通用</li>
<li>dig只存在于Linux及FreeBSD等开源系统中。<code>dig @114.114.114.114 sina.com.cn</code></li>
<li>finger和w命令可查询用户的信息</li>
<li>lsof列出当先系统打开的文件。<code>lsof -i:4000</code>查看4000端口由哪些程序占用</li>
<li>sockstat查看打开插口的情况，CentOS5.8中无此命令</li>
</ol>
<h3 id="1-3-3-查看Linux服务器的进程"><a href="#1-3-3-查看Linux服务器的进程" class="headerlink" title="1.3.3 查看Linux服务器的进程"></a>1.3.3 查看Linux服务器的进程</h3><ol>
<li><code>ps aux</code>获得终端上所有用户的有关进程的所有信息。输出中STAT列表示进程的运行状态，包括以下几种代码<ul>
<li>D 不可中断的睡眠</li>
<li>R 就绪</li>
<li>S 睡眠</li>
<li>T 被跟踪或停止</li>
<li>Z 终止（僵死）的进程</li>
<li>W 没有足够的内存分页可分配</li>
<li>&lt; 高优先序的进程</li>
<li>N 低优先序的进程</li>
<li>L 有内存分页分配并锁在内存体内（实时系统或IO）</li>
</ul>
</li>
<li>top基本类似于ps，且可以通过按键动态地刷新状态</li>
<li>pgrep查找当前运行的进程，并列出匹配给定条件进程的pid</li>
<li>kill    根据pid，给进程发送信号，默认为15</li>
<li>killall 根据程序的名字，直接杀死所有进程<h3 id="1-3-4-添加静态路由"><a href="#1-3-4-添加静态路由" class="headerlink" title="1.3.4 添加静态路由"></a>1.3.4 添加静态路由</h3></li>
<li>win：<code>route add 目的网段 mask 子网掩码 下一跳IP</code>用于临时添加静态路由，重启后会消失。想让路由一直保持需要加上-p开关，如<code>route -p add 10.10.0.0 mask 255.255.0.0 192.168.4.222</code></li>
<li>CentOS<ul>
<li>临时<code>route add -net 172.16.6.0 netmask 255.255.255.0 gw 172.16.2.25</code></li>
<li>永久添加需要编辑<code>/etc/sysconfig/network-scripts/route-eth0</code>添加一行<code>127.16.6.0/24 via 172.16.2.25</code></li>
<li>Debian系的网卡配置跟Redhat系很不一样，Redhat是放在/etc/sysconfig/network-scripts目录下面的一大堆文件里面。而Debian系的网卡配置则是存在/etc/network/interfaces</li>
</ul>
</li>
<li>FreeBSD<ul>
<li>临时<code>route add -net 172.16.0.0/24 172.16.2.25</code></li>
<li>永久添加需要编辑<code>/etc/rc.conf</code></li>
</ul>
</li>
</ol>
<h1 id="ch08-Linux防火墙及系统安全"><a href="#ch08-Linux防火墙及系统安全" class="headerlink" title="ch08 Linux防火墙及系统安全"></a>ch08 Linux防火墙及系统安全</h1><p>本章介绍Netfilter/iptables</p>
<h2 id="8-1-基础网络知识"><a href="#8-1-基础网络知识" class="headerlink" title="8.1 基础网络知识"></a>8.1 基础网络知识</h2><p>跳过</p>
<h2 id="8-2-Linux防火墙的概念"><a href="#8-2-Linux防火墙的概念" class="headerlink" title="8.2 Linux防火墙的概念"></a>8.2 Linux防火墙的概念</h2><p>Netfilter是内核的模块实现，iptables是上层的操作工具</p>
<p>有状态的防火墙能够指定并记住为发送或接收信息包所建立的连接状态，以增加其效率和速度。Netfilter/iptables有4种有效状态</p>
<ol>
<li>ESTABLISHED：已建立的连接</li>
<li>INVALID：与任何已知的流或连接都不相关联</li>
<li>NEW：该信息包已经或将启动新连接，或者它与尚未用于发送和接收信息包的连接相关联</li>
<li>RELATED：正在启动新连接</li>
</ol>
<h2 id="8-3-Linux防火墙在企业中的作用"><a href="#8-3-Linux防火墙在企业中的作用" class="headerlink" title="8.3 Linux防火墙在企业中的作用"></a>8.3 Linux防火墙在企业中的作用</h2><ol>
<li>IDC机房一般没有硬件防火墙，用开源免费的iptables是一个性价比高的选择。</li>
<li>iptables可以结合squid作为企业内部上网的透明代理</li>
<li>很多中小型企业和网吧利用iptables作为企业的NAT路由器。优势：节约成本、有效控制<ul>
<li>可以使用iptables的扩展模块屏蔽P2P流量、禁止非法网页。但建议通过行政手段控制非法流量。</li>
</ul>
</li>
<li>iptables还可以用于外网IP向内网IP映射，这种形式的NAT一般称为DNAT</li>
<li>iptables可以防止轻量级的DOS攻击</li>
</ol>
<h2 id="8-4-Linux防火墙的语法"><a href="#8-4-Linux防火墙的语法" class="headerlink" title="8.4 Linux防火墙的语法"></a>8.4 Linux防火墙的语法</h2><p>数据包的流向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">           ------FORWARD------</span><br><span class="line">          &#x2F;                   \</span><br><span class="line">PREROUTING                     POSTROUTING</span><br><span class="line">          \                   &#x2F;</span><br><span class="line">           INPUT -&gt; 本机OUTPUT</span><br></pre></td></tr></table></figure>
<p>iptables的两种工作模式：作为NAT路由器、作为主机防火墙</p>
<p>三个规则表</p>
<ol>
<li>filter</li>
<li>nat</li>
<li>mangle</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/08/10/high-availability-linux/" data-id="cl310rf3c000lgctk5dte7l4i" data-title="《构建高可用Linux服务器》读书笔记" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/12/20/2021-08-19-work-log/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          网管工作日志
        
      </div>
    </a>
  
  
    <a href="/2021/07/21/mysql-ji-shu-nei-mu/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">《mysql技术内幕》读书笔记</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/bao-xian/">bao-xian</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book-note/">book-note</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/health/">health</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/humor/">humor</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jekyll-update/">jekyll update</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/1021/04/">April 1021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/15/ffmpeg/">《ffmpeg从入门到精通》读书笔记</a>
          </li>
        
          <li>
            <a href="/2021/12/20/2021-08-19-work-log/">网管工作日志</a>
          </li>
        
          <li>
            <a href="/2021/08/10/high-availability-linux/">《构建高可用Linux服务器》读书笔记</a>
          </li>
        
          <li>
            <a href="/2021/07/21/mysql-ji-shu-nei-mu/">《mysql技术内幕》读书笔记</a>
          </li>
        
          <li>
            <a href="/2021/07/19/ubuntu-linux-os/">Ubuntu相关读书笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>